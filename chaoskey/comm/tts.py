# -*- coding: utf-8 -*-# 我的Anki插件# 作者：混沌(youliang@chaoskey.com), http://blog.chaoskey.comimport threadingimport win32com.client# 阅读模式class TTSSpeaker(threading.Thread):    def __init__(self):        self.ttsQueue = []        self.ttsEvt = threading.Event()        self.runing=True        self.speaker=win32com.client.Dispatch('SAPI.SpVoice')        threading.Thread.__init__(self)    def run(self):        print "----------start-----------"        while self.runing:            self.ttsEvt.wait()            self.ttsEvt.clear()            while self.ttsQueue:                try:                    text,name=self.ttsQueue.pop(0)                    if name:                        vs=self.speaker.GetVoices("Name=%s"%name)                        if vs and len(vs)>0:                            self.speaker.Voice=vs.Item(0)                    self.speaker.Speak(text,1)                    self.speaker.WaitUntilDone(-1)                except:                    continue    def play(self,text,voice=None):        self.ttsQueue.append((text,voice,))        self.ttsEvt.set()    # 彻底停止speaker    def kill(self):        self.runing=False        self.ttsQueue=[]        self.ttsEvt.set()        self.speaker.Speak("",2)    # 清除正在播放的tts，但不停止speaker    def clear(self):        self.ttsQueue=[]        self.ttsEvt.set()        self.speaker.Speak("",2)        def voiceName(self):        return self.speaker.Voice.GetAttribute("Name")        def voices(self,name=None):        if name:            return self.speaker.GetVoices("Name=%s"%name)        return self.speaker.GetVoices()